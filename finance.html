<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë„¤ì´ë²„ ì¦ì‹œ í´ë¡  - ê¸ˆìœµ ë‰´ìŠ¤ ë¶„ì„ í”Œë«í¼</title>
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ ì´ˆê¸°í™” ë° í°íŠ¸ ì„¤ì • */
        body {
            font-family: 'Naver NanumGothic', 'Malgun Gothic', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f7f7f7; /* ë„¤ì´ë²„ ë°°ê²½ìƒ‰ê³¼ ìœ ì‚¬ */
            color: #1c1c1c;
        }

        /* í—¤ë” ìŠ¤íƒ€ì¼ */
        header {
            background-color: #fff;
            border-bottom: 1px solid #ebebeb;
            padding: 10px 0;
        }
        .header-content {
            width: 1080px; /* ë„¤ì´ë²„ í‘œì¤€ ë„ˆë¹„ */
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo a {
            font-size: 24px;
            font-weight: bold;
            color: #008850; /* ë„¤ì´ë²„ ê·¸ë¦° */
            text-decoration: none;
        }
        nav a {
            margin-left: 20px;
            text-decoration: none;
            color: #333;
            color: #1c1c1c;
            font-size: 14px;
        }
        nav a:hover {
            color: #008850;
        }

        /* ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ */
        .container {
        .main-content {
            width: 1080px;
            margin: 20px auto;
            display: flex; /* ë©”ì¸ ì»¨í…ì¸ ë¥¼ ê°€ë¡œë¡œ ë°°ì¹˜ */
            display: flex;
            gap: 20px;
        }

        /* ì™¼ìª½ ì„¹ì…˜ (ì£¼ìš” ì§€ìˆ˜, ê´€ì‹¬ì¢…ëª©, ë‰´ìŠ¤/í† ë¡  ë“±) */
        .main-content {
            flex: 3; /* 70% ì •ë„ ë„ˆë¹„ */
            min-width: 700px;
        }

        /* ì˜¤ë¥¸ìª½ ì„¹ì…˜ (ê´‘ê³ , ë­í‚¹ ë“± ë³´ì¡° ì •ë³´) */
        .side-content {
            flex: 1; /* 30% ì •ë„ ë„ˆë¹„ */
            min-width: 300px;
        /* ì™¼ìª½ ì„¹ì…˜ (ê¸ˆìœµ ì§€ìˆ˜ ë° ì‹œê°€ì´ì•¡) */
        .left-section {
            flex: 2; /* ì˜¤ë¥¸ìª½ë³´ë‹¤ 2ë°° ë„“ê²Œ */
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* ê³µí†µ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .card {
        /* ì˜¤ë¥¸ìª½ ì„¹ì…˜ (LLM ì±—ë´‡) */
        .right-section {
            flex: 1;
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }
        .card h3 {
            border-bottom: 2px solid #008850;
            padding-bottom: 10px;
            margin-top: 0;
            font-size: 18px;
            color: #1c1c1c;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            max-height: 800px;
        }

        /* ì£¼ìš” ì§€ìˆ˜ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .index-card {
        /* ê¸ˆìœµ ì§€ìˆ˜ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .index-cards {
            display: flex;
            justify-content: space-between;
            text-align: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        .index-item {
        .index-card {
            background-color: #fff;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            flex: 1;
        }
        .index-item .value {
            font-size: 32px;
            font-weight: bold;
            color: #d84a4a; /* ê¸°ë³¸ í•˜ë½ (ë¹¨ê°„ìƒ‰) */
            margin-top: 5px;
        }
        .index-item .change {
        .index-name {
            font-size: 16px;
            color: #d84a4a; /* ê¸°ë³¸ í•˜ë½ (ë¹¨ê°„ìƒ‰) */
            color: #666;
            margin-bottom: 5px;
        }

        /* ë‰´ìŠ¤ ëª©ë¡ ìŠ¤íƒ€ì¼ */
        .news-list {
            list-style: none;
            padding: 0;
        }
        .news-list li {
            border-bottom: 1px dotted #eee;
            padding: 8px 0;
            font-size: 14px;
        }
        .news-list li:last-child {
            border-bottom: none;
        }
        /* LLM ì±—ë´‡ ìŠ¤íƒ€ì¼ */
        #llm-chat-container {
            border-top: 1px solid #eee;
            margin-top: 15px;
            padding-top: 15px;
        .index-value {
            font-size: 24px;
            font-weight: bold;
            color: #1c1c1c;
        }
        .chat-response {
            background-color: #e6f7ff;
            border-left: 3px solid #008850;
            padding: 10px;
        .index-change {
            font-size: 14px;
            color: #333;
            margin-bottom: 10px;
            margin-top: 5px;
        }
    .stock-table-card {
             margin-top: 15px; /* êµ­ë‚´ ì¦ì‹œ ì¹´ë“œì™€ì˜ ê°„ê²© */
             border-top: 1px solid #008850; /* êµ¬ë¶„ì„ ìœ„í•œ ìƒë‹¨ ë¼ì¸ */
             padding-top: 15px;
        .text-up { color: #d80000; } /* ë¹¨ê°„ìƒ‰ (ìƒìŠ¹) */
        .text-down { color: #0059c4; } /* íŒŒë€ìƒ‰ (í•˜ë½) */
        .text-flat { color: #666; } /* íšŒìƒ‰ (ë³´í•©) */

        /* ì‹œê°€ì´ì•¡ í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        .market-sum-table-container {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            overflow-x: auto; /* ëª¨ë°”ì¼ ëŒ€ì‘ì„ ìœ„í•œ ìŠ¤í¬ë¡¤ */
        }
        #market-sum-table {
        .market-sum-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }
        #market-sum-table th, #market-sum-table td {
            border: none; /* ê¸°ì¡´ border-collapse ìœ ì§€ */
            padding: 8px 10px;
        .market-sum-table th, .market-sum-table td {
            padding: 10px;
            border-bottom: 1px solid #eee;
            text-align: right;
            white-space: nowrap; /* ì…€ ë‚´ìš© ì¤„ë°”ê¿ˆ ë°©ì§€ */
        }
        #market-sum-table th {
        .market-sum-table th {
            background-color: #f7f7f7;
            border-bottom: 1px solid #ebebeb;
            font-weight: normal;
            font-weight: 500;
            color: #666;
            text-align: center;
        }
        .market-sum-table td:first-child {
            text-align: left; /* ì¢…ëª©ëª…ì€ ì™¼ìª½ ì •ë ¬ */
            font-weight: bold;
            color: #333;
        }
        .text-left { text-align: left !important; }
        .red-text { color: #d84a4a; font-weight: bold; } /* ìƒìŠ¹ */
        .green-text { color: #008850; font-weight: bold; } /* í•˜ë½ (ì¦ì‹œ ê´€ë¡€) */
        .text-right { text-align: right !important; }

        /* LLM ì±—ë´‡ ìŠ¤íƒ€ì¼ */
        #llm-output {
            height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 15px;
            background-color: #f9f9f9;
            border-radius: 4px;
            white-space: pre-wrap; /* ì¤„ë°”ê¿ˆ ìœ ì§€ */
        }
        #llm-chat-form {
            display: flex;
            gap: 10px;
        }
        #llm-input {
            flex-grow: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        #llm-submit {
            padding: 8px 15px;
            border: none;
            background-color: #008850;
            color: white;
            border-radius: 4px;
            cursor: pointer;
        }
        #llm-submit:disabled {
            background-color: #a8a8a8;
        }
    </style>
</head>
<body>

    <header>
        <div class="header-content">
            <div class="logo"><a href="#">ì£¼ìš” ì¦ì‹œ</a></div>
            <div class="logo"><a href="#">ë„¤ì´ë²„ ì¦ì‹œ í´ë¡ </a></div>
            <nav>
                <a href="https://finance.naver.com/sise/">êµ­ë‚´ì¦ì‹œ</a>
                <a href="https://finance.naver.com/world/">í•´ì™¸ì¦ì‹œ</a>
                <a href="https://finance.naver.com/marketindex/">ì‹œì¥ë¶„ì„</a>
                <a href="https://finance.naver.com/news/">ê¸ˆìœµë‰´ìŠ¤</a>
                <a href="index.html">ì»¤ë®¤ë‹ˆí‹°</a>
                <a href="#">í™ˆ</a>
                <a href="#">ì‹œí™©</a>
                <a href="#">ë‰´ìŠ¤</a>
                <a href="#">ë§ˆì´ë°ì´í„°</a>
            </nav>
        </div>
    </header>

    <div class="container">
        <div class="main-content">
            <div class="card">
                <h3>êµ­ë‚´ ì¦ì‹œ</h3>
                <div class="index-card">
                    <div class="index-item" id="kospi-index">
                        <p>KOSPI</p>
                        <p class="value">Error</p>
                        <p class="change">Loading...</p>
                    </div>
                    <div class="index-item" id="kosdaq-index">
                        <p>KOSDAQ</p>
                        <p class="value">Error</p>
                        <p class="change">Loading...</p>
                    </div>
                    <div class="index-item">
                        <p>í™˜ìœ¨(USD/KRW)</p>
                        <p class="value" style="color: #d84a4a;">1,350.50</p>
                        <p class="change" style="color: #d84a4a;">+2.50 (+0.18%)</p>
                    </div>
    <div class="main-content">
        
        <!-- ì™¼ìª½: ê¸ˆìœµ ì§€ìˆ˜ ë° ì‹œê°€ì´ì•¡ -->
        <div class="left-section">
            
            <!-- ê¸ˆìœµ ì§€ìˆ˜ ì˜ì—­ -->
            <h2>ì£¼ìš” ê¸ˆìœµ ì§€ìˆ˜</h2>
            <div class="index-cards">
                <div id="index-kospi" class="index-card">
                    <div class="index-name">KOSPI</div>
                    <div class="index-value">...</div>
                    <div class="index-change">...</div>
                </div>
                <div id="index-kosdaq" class="index-card">
                    <div class="index-name">KOSDAQ</div>
                    <div class="index-value">...</div>
                    <div class="index-change">...</div>
                </div>
                <div id="index-dow" class="index-card">
                    <div class="index-name">Dow Jones</div>
                    <div class="index-value">...</div>
                    <div class="index-change">...</div>
                </div>
                <div id="index-nasdaq" class="index-card">
                    <div class="index-name">NASDAQ</div>
                    <div class="index-value">...</div>
                    <div class="index-change">...</div>
                </div>
            </div>

            <div class="card stock-table-card">
                <h3>ì‹œê°€ì´ì•¡ ìƒìœ„ ì¢…ëª© (í¬ë¡¤ë§ ë°ì´í„°)</h3>
                <div id="market-sum-status" style="padding: 10px; color: #d84a4a; text-align: center;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                <table id="market-sum-table" style="display: none;">
            <!-- ì‹œê°€ì´ì•¡ í…Œì´ë¸” ì˜ì—­ -->
            <h2>ì½”ìŠ¤í”¼ ì‹œê°€ì´ì•¡ ìƒìœ„ ì¢…ëª©</h2>
            <div class="market-sum-table-container">
                <p id="loading-status">ë°ì´í„°ë¥¼ ë¡œë“œí•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
                <table class="market-sum-table" id="stock-market-sum-table" style="display: none;">
                    <thead>
                        <tr id="market-sum-header"></tr>
                        <tr></tr>
                    </thead>
                    <tbody id="market-sum-body"></tbody>
                    <tbody>
                        <!-- ë°ì´í„°ëŠ” JavaScriptë¡œ ì±„ì›Œì§‘ë‹ˆë‹¤. -->
                    </tbody>
                </table>
            </div>
            <div class="card">
                <h3>ê¸ˆìœµ ë‰´ìŠ¤ ë° ë¶„ì„ ê²°ê³¼</h3>
                <ul class="news-list" id="news-list-ul">
                    <li><a href="#">[ì†ë³´] íŒŒì›” ì˜ì¥, ì¸í”Œë ˆì´ì…˜ ë‘”í™” ë°œì–¸... ë‰´ìš• ì¦ì‹œ ìƒìŠ¹ ë§ˆê°</a></li>
                    <li><a href="#">LLM ê¸°ë°˜ ì¢…ëª© ë¶„ì„: 'ì‚¼ì„±ì „ì', ë§¤ìˆ˜ ì˜ê²¬ ì§€ë°°ì  (ë¯¸êµ¬í˜„)</a></li>
                    <li><a href="#">[ë‹¨ë…] ì‹ ê·œ AI ì¹© ì¶œì‹œ ì„ë°• ì†Œì‹ì— ê´€ë ¨ì£¼ ê¸‰ë“±</a></li>
                </ul>
                
                <div id="llm-chat-container">
                    <h4 style="font-size: 16px; font-weight: bold; margin-bottom: 10px; color: #008850;">ğŸ¤– LLM ë¶„ì„ê°€ì—ê²Œ ì§ˆë¬¸í•˜ê¸°</h4>
                    <div id="chat-response-box" class="chat-response hidden"></div>

                    <form id="llm-chat-form" style="display: flex; gap: 10px;">
                        <input type="text" id="chat-input" placeholder="ì˜ˆ: ì‚¼ì„±ì „ì ì „ë§ì„ ì•Œë ¤ì¤˜" 
                               style="flex-grow: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;" required>
                        <button type="submit" 
                                style="padding: 8px 15px; background-color: #008850; color: white; border: none; border-radius: 4px; font-size: 14px; cursor: pointer;">
                            ë¶„ì„ ìš”ì²­
                        </button>
                    </form>
                </div>
            </div>

        </div>

        <div class="side-content">
            <div class="card">
                <h3>í•´ì™¸ ì¦ì‹œ</h3>
                </div>
        <!-- ì˜¤ë¥¸ìª½: LLM ì±—ë´‡ ì˜ì—­ -->
        <div class="right-section">
            <h2>LLM ê¸ˆìœµ ë¶„ì„ ì±—ë´‡</h2>
            <div id="llm-output">ì•ˆë…•í•˜ì„¸ìš”! ê¶ê¸ˆí•œ ì ì„ ì§ˆë¬¸í•´ ì£¼ì„¸ìš”.</div>
            <form id="llm-chat-form">
                <input type="text" id="llm-input" placeholder="ì‚¼ì„±ì „ì ì£¼ê°€ ì „ë§ì€?" required>
                <button type="submit" id="llm-submit">ë¶„ì„ ìš”ì²­</button>
            </form>
        </div>
    </div>

    </div>

</body>
<script>
        // ğŸ’¡ API ì£¼ì†Œë¥¼ ì‹¤ì œ ë°±ì—”ë“œ(ALB) ì£¼ì†Œë¡œ ì„¤ì •
    <script>
        // -------------------------------------------------------------
        // 1. ì‹œê°€ì´ì•¡ ë°ì´í„° ë¡œë“œ ë° í…Œì´ë¸” ê·¸ë¦¬ê¸° ë¡œì§ (ì£¼ìš” ìˆ˜ì • ì‚¬í•­)
        // -------------------------------------------------------------
        // ğŸ’¡ API ì£¼ì†Œë¥¼ ì°¬ê·œë‹˜ì˜ ALB ì£¼ì†Œë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
        const API_URL = 'http://api.chxtwo.kro.kr'; 
        
        // í‘œì‹œí•  í—¤ë”ì˜ ìˆœì„œë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
        const DISPLAY_HEADERS = ['ì¢…ëª©ëª…', 'í˜„ì¬ê°€', 'ì „ì¼ë¹„', 'ë“±ë½ë¥ ', 'ì‹œê°€ì´ì•¡', 'PER', 'ROE', 'ì™¸êµ­ì¸ë¹„ìœ¨'];
        
        // DynamoDB í‚¤ì™€ í‘œì‹œ í—¤ë” ë§¤í•‘ (DynamoDBì—ì„œ ê°€ì ¸ì˜¨ í‚¤ëŠ” ê³µë°±ì´ ì—†ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤)
        const KEY_MAPPING = {
            'ì¢…ëª©ëª…': 'ì¢…ëª©ëª…',
            'í˜„ì¬ê°€': 'í˜„ì¬ê°€',
            'ì „ì¼ë¹„': 'ì „ì¼ë¹„',
            'ë“±ë½ë¥ ': 'ë“±ë½ë¥ ',
            'ì‹œê°€ì´ì•¡': 'ì‹œê°€ì´ì•¡',
            'PER': 'PER',
            'ROE': 'ROE',
            'ì™¸êµ­ì¸ë¹„ìœ¨': 'ì™¸êµ­ì¸ë¹„ìœ¨'
        };


        /**
         * DynamoDB í¬ë¡¤ë§ ë°ì´í„°ë¥¼ Flask APIë¥¼ í†µí•´ ë¶ˆëŸ¬ì™€ í‘œì‹œí•˜ëŠ” í•¨ìˆ˜
         */
        async function loadStockMarketData() {
            const statusElement = document.getElementById('market-sum-status');
            const tableElement = document.getElementById('market-sum-table');
            const headerRow = document.getElementById('market-sum-header');
            const tableBody = document.getElementById('market-sum-body');

            statusElement.textContent = 'ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...';
            const tableElement = document.getElementById('stock-market-sum-table');
            const statusElement = document.getElementById('loading-status');
            const tbody = tableElement.querySelector('tbody');
            const theadRow = tableElement.querySelector('thead tr');
            
            statusElement.textContent = "ìµœì‹  ì‹œê°€ì´ì•¡ ë°ì´í„°ë¥¼ ë¡œë“œí•˜ëŠ” ì¤‘...";
            statusElement.style.color = '#008850';
            tbody.innerHTML = '';
            theadRow.innerHTML = '';
            tableElement.style.display = 'none';

            try {
                // Flask ì„œë²„ì˜ ìƒˆë¡œìš´ ì—”ë“œí¬ì¸íŠ¸ í˜¸ì¶œ (app.pyì˜ 13ë²ˆ ì„¹ì…˜)
                // Flask ì„œë²„ì˜ API ì—”ë“œí¬ì¸íŠ¸ë¡œ Fetch ìš”ì²­ (ALB ì£¼ì†Œ ì‚¬ìš©)
                const response = await fetch(`${API_URL}/api/stock/market-sum`);

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'ì‹œê°€ì´ì•¡ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
                    const errorJson = await response.json();
                    throw new Error(`API ì‘ë‹µ ì˜¤ë¥˜: ${response.status} - ${errorJson.error || response.statusText}`);
                }

                const data = await response.json();

                if (data.length === 0) {
                    statusElement.textContent = 'ë°ì´í„°ê°€ DynamoDBì— ì—†ìŠµë‹ˆë‹¤.';
                    tableElement.style.display = 'none';
                if (!data || data.length === 0) {
                    statusElement.textContent = "ë°ì´í„°ê°€ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤. fi.pyë¡œ í¬ë¡¤ë§ì„ ë¨¼ì € ì‹¤í–‰í•´ ì£¼ì„¸ìš”.";
                    statusElement.style.color = 'orange';
                    return;
                }

                // 1. í—¤ë” ìƒì„±
                headerRow.innerHTML = '';
                tableBody.innerHTML = '';
                DISPLAY_HEADERS.forEach(header => {
                // í…Œì´ë¸” í—¤ë” ìƒì„± (ì²« ë²ˆì§¸ í•­ëª©ì˜ í‚¤ ì‚¬ìš©)
                const headers = Object.keys(data[0]);
                headers.forEach(key => {
                    const th = document.createElement('th');
                    th.textContent = header;
                    th.classList.add(header === 'ì¢…ëª©ëª…' ? 'text-left' : 'text-right');
                    headerRow.appendChild(th);
                    th.textContent = key;
                    theadRow.appendChild(th);
                });

                // 2. ë°ì´í„° í–‰ ì‚½ì…
                // í…Œì´ë¸” ë³¸ë¬¸ ìƒì„±
                data.forEach(item => {
                    const tr = tableBody.insertRow();
                    DISPLAY_HEADERS.forEach(header => {
                        const td = tr.insertCell();
                        const key = KEY_MAPPING[header];
                    const tr = document.createElement('tr');
                    
                    headers.forEach(key => {
                        const td = document.createElement('td');
                        let value = item[key];
                        
                        // ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš° '-' ì²˜ë¦¬

                        if (value === undefined || value === null) {
                            td.textContent = '-';
                        } else {
                            // ë“±ë½ë¥ ì— ë”°ë¥¸ ìƒ‰ìƒ ì²˜ë¦¬
                            if (key === 'ë“±ë½ë¥ ') {
                                td.textContent = `${value.toFixed(2)}%`;
                                if (value > 0) td.classList.add('red-text');
                                else if (value < 0) td.classList.add('green-text');
                            } 
                            // ì‹œê°€ì´ì•¡, í˜„ì¬ê°€ ë“± ìˆ«ìì— ì‰¼í‘œ(,) ì¶”ê°€
                            else if (typeof value === 'number' && ['ì‹œê°€ì´ì•¡', 'í˜„ì¬ê°€'].includes(key)) {
                                td.textContent = value.toLocaleString('ko-KR');
                            }
                            // ì¢…ëª©ëª…ì€ ì™¼ìª½ ì •ë ¬
                            else if (key === 'ì¢…ëª©ëª…') {
                                td.textContent = value;
                                td.classList.add('text-left');
                                td.style.fontWeight = 'bold';
                            }
                            // ê¸°íƒ€ ë°ì´í„°
                            else {
                            // ìˆ«ì í˜•ì‹ì¼ ê²½ìš° ì‰¼í‘œ ì¶”ê°€ (ì¢…ëª©ëª…, ë“±ë½ë¥ ì€ ì œì™¸)
                            if (key !== 'ì¢…ëª©ëª…' && key !== 'ë“±ë½ë¥ ') {
                                // ì†Œìˆ˜ì ì´ ì—†ëŠ” ì •ìˆ˜ë¡œ ë³€í™˜ í›„ ì‰¼í‘œ ì¶”ê°€ (Decimal ì²˜ë¦¬ëœ float ê°€ì •)
                                // 'ì‹œê°€ì´ì•¡', 'ìƒì¥ì£¼ì‹ìˆ˜' ë“± í° ìˆ«ìëŠ” ì •ìˆ˜ë¡œ ì²˜ë¦¬
                                if (key === 'ì‹œê°€ì´ì•¡' || key === 'ìƒì¥ì£¼ì‹ìˆ˜' || key === 'í˜„ì¬ê°€' || key === 'ê±°ë˜ëŸ‰') {
                                    td.textContent = Math.round(parseFloat(value)).toLocaleString('ko-KR');
                                } else {
                                    // PER, ROE ë“± ì†Œìˆ˜ì  í•„ìš” í•­ëª©ì€ ê·¸ëŒ€ë¡œ í‘œì‹œ
                                    td.textContent = value;
                                }
                            } else if (key === 'ë“±ë½ë¥ ' && typeof value === 'number') {
                                // ë“±ë½ë¥ ì€ ë¶€í˜¸ì— ë”°ë¼ ìƒ‰ìƒ ë³€ê²½
                                td.textContent = `${value}%`;
                                if (value > 0) td.classList.add('text-up');
                                else if (value < 0) td.classList.add('text-down');
                            } else {
                                td.textContent = value;
                            }
                        }
                        // ê¸°ë³¸ ì •ë ¬ì€ ì˜¤ë¥¸ìª½ìœ¼ë¡œ (ì¢…ëª©ëª… ì œì™¸)
                        if (key !== 'ì¢…ëª©ëª…') td.classList.add('text-right');
                        tr.appendChild(td);
                    });
                    tbody.appendChild(tr);
                });

                statusElement.style.display = 'none';
                tableElement.style.display = 'table'; // í…Œì´ë¸” í‘œì‹œ ì„±ê³µ

            } catch (error) {
                console.error("í¬ë¡¤ë§ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:", error);
                statusElement.textContent = `ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ${error.message}`;
                statusElement.style.color = 'red';
                tableElement.style.display = 'none';
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ í¬ë¡¤ë§ ë°ì´í„° ë¡œë“œ
        // í˜ì´ì§€ ë¡œë“œ ì‹œ í¬ë¡¤ë§ ë°ì´í„° ë¡œë“œ ì‹œì‘
        document.addEventListener('DOMContentLoaded', loadStockMarketData); 

        // -------------------------------------------------------------
        // (ê¸°ì¡´ loadFinanceData, updateIndex, LLM ì±—ë´‡ ë¡œì§ì€ ìœ ì§€ë©ë‹ˆë‹¤.)
        // 2. ê¸ˆìœµ ì§€ìˆ˜ ë¡œë“œ ë° ì—…ë°ì´íŠ¸ ë¡œì§ (ê¸°ì¡´ ì½”ë“œ ìœ ì§€)
        // -------------------------------------------------------------

        // LLM ì±—ë´‡ ë¡œì§ (ì´ì „ ì½”ë“œì™€ ë™ì¼)
        document.getElementById('llm-chat-form').addEventListener('submit', async (e) => { /* ... */ });
        
        // ê¸ˆìœµ ì§€ìˆ˜ ë¡œë“œ (ì´ì „ ì½”ë“œì™€ ë™ì¼)
        async function loadFinanceData() { /* ... */ }
        function updateIndex(elementId, indexData) { /* ... */ }
        // ì§€ìˆ˜ ì¹´ë“œ ì—…ë°ì´íŠ¸ í—¬í¼ í•¨ìˆ˜
        function updateIndex(elementId, indexData) {
            const card = document.getElementById(elementId);
            if (!card) return;
            
            const valueEl = card.querySelector('.index-value');
            const changeEl = card.querySelector('.index-change');
            
            valueEl.textContent = indexData.í˜„ì¬ê°€ || 'N/A';
            changeEl.textContent = `${indexData.ì „ì¼ë¹„ || 'N/A'} (${indexData.ë“±ë½ë¥  || 'N/A'})`;
            
            // ìƒ‰ìƒ ì—…ë°ì´íŠ¸
            changeEl.classList.remove('text-up', 'text-down', 'text-flat');
            const change = parseFloat(indexData.ì „ì¼ë¹„.replace(/,/g, ''));
            if (change > 0) changeEl.classList.add('text-up');
            else if (change < 0) changeEl.classList.add('text-down');
            else changeEl.classList.add('text-flat');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° ë¡œë“œ ì‹œì‘
        // ê¸ˆìœµ ì§€ìˆ˜ ë°ì´í„° ë¡œë“œ (ê°€ìƒì˜ API ì‚¬ìš©, ì‹¤ì œ êµ¬í˜„ í•„ìš”)
        async function loadFinanceData() {
            // ì´ ë¶€ë¶„ì€ ì‹¤ì œ ê¸ˆìœµ ì§€ìˆ˜ APIë¥¼ í˜¸ì¶œí•´ì•¼ í•©ë‹ˆë‹¤.
            // ì—¬ê¸°ì„œëŠ” ì„ì‹œ ë°ì´í„°ë¡œ ì§€ìˆ˜ ì¹´ë“œë§Œ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
            const tempIndices = [
                { id: 'index-kospi', name: 'KOSPI', í˜„ì¬ê°€: '2,500.00', ì „ì¼ë¹„: '+15.50', ë“±ë½ë¥ : '+0.62%', type: 'up' },
                { id: 'index-kosdaq', name: 'KOSDAQ', í˜„ì¬ê°€: '850.50', ì „ì¼ë¹„: '-5.20', ë“±ë½ë¥ : '-0.61%', type: 'down' },
                { id: 'index-dow', name: 'Dow Jones', í˜„ì¬ê°€: '38,000.00', ì „ì¼ë¹„: '+150.00', ë“±ë½ë¥ : '+0.40%', type: 'up' },
                { id: 'index-nasdaq', name: 'NASDAQ', í˜„ì¬ê°€: '15,000.00', ì „ì¼ë¹„: '-50.00', ë“±ë½ë¥ : '-0.33%', type: 'down' },
            ];

            tempIndices.forEach(index => {
                updateIndex(index.id, {
                    í˜„ì¬ê°€: index.í˜„ì¬ê°€,
                    ì „ì¼ë¹„: index.ì „ì¼ë¹„,
                    ë“±ë½ë¥ : index.ë“±ë½ë¥ ,
                });
            });
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ê¸ˆìœµ ì§€ìˆ˜ ë¡œë“œ ì‹œì‘
        loadFinanceData(); 

        // 1ë¶„(60000ms)ë§ˆë‹¤ ë°ì´í„° ìƒˆë¡œê³ ì¹¨
        setInterval(loadFinanceData, 60000); 
        // -------------------------------------------------------------
        // 3. LLM ì±—ë´‡ ë¡œì§ (ê¸°ì¡´ ì½”ë“œ ìœ ì§€)
        // -------------------------------------------------------------
        const llmChatForm = document.getElementById('llm-chat-form');
        const llmInput = document.getElementById('llm-input');
        const llmOutput = document.getElementById('llm-output');
        const llmSubmit = document.getElementById('llm-submit');
        
        // LLM ì±—ë´‡ ë¡œì§ (API í‚¤ëŠ” Canvas í™˜ê²½ì—ì„œ ìë™ìœ¼ë¡œ ì œê³µ)
        llmChatForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const prompt = llmInput.value.trim();
            if (!prompt) return;

            llmOutput.textContent = `User: ${prompt}\n\nLLM: ë¶„ì„ ì¤‘... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.`;
            llmSubmit.disabled = true;

            const userQuery = `ê¸ˆìœµ ë° ì£¼ì‹ ì‹œì¥ ë¶„ì„ê°€ì²˜ëŸ¼ í–‰ë™í•˜ì—¬ ì‚¬ìš©ì ì§ˆë¬¸ì— ë‹µí•˜ì„¸ìš”. ì§ˆë¬¸: ${prompt}`;
            
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                tools: [{ "google_search": {} }],
                systemInstruction: {
                    parts: [{ text: "ë‹¹ì‹ ì€ ì„¸ê³„ì ì¸ ê¸ˆìœµ ë¶„ì„ê°€ì…ë‹ˆë‹¤. ë„¤ì´ë²„ ì¦ì‹œ ë°ì´í„°ì™€ ì‹¤ì‹œê°„ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ëª…í™•í•˜ê³  ê°„ê²°í•˜ê²Œ ë‹µë³€í•©ë‹ˆë‹¤. ë‹µë³€ì€ í•œêµ­ì–´ë¡œ ì œê³µí•©ë‹ˆë‹¤." }]
                },
            };
            
            const apiKey = ""; // Canvas í™˜ê²½ì—ì„œ ìë™ ì£¼ì…
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) {
                    throw new Error(`API ìš”ì²­ ì‹¤íŒ¨: ${response.status} ${response.statusText}`);
                }

                const result = await response.json();
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text || "ë‹µë³€ì„ ìƒì„±í•˜ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
                
                llmOutput.textContent = `User: ${prompt}\n\nLLM: ${text}`;
                
            } catch (error) {
                console.error("LLM API ì˜¤ë¥˜:", error);
                llmOutput.textContent = `User: ${prompt}\n\nLLM: ì£„ì†¡í•©ë‹ˆë‹¤. ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`;
            } finally {
                llmSubmit.disabled = false;
                llmInput.value = '';
            }
        });

    </script>
</html>
</body>
</html>