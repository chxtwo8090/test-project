<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>네이버 증시 클론 - 금융 뉴스 분석 플랫폼</title>
    <style>
        /* 기본 스타일 초기화 및 폰트 설정 */
        body {
            font-family: 'Naver NanumGothic', 'Malgun Gothic', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f7f7f7; /* 네이버 배경색과 유사 */
            color: #1c1c1c;
        }

        /* 헤더 스타일 */
        header {
            background-color: #fff;
            border-bottom: 1px solid #ebebeb;
            padding: 10px 0;
        }
        .header-content {
            width: 1080px; /* 네이버 표준 너비 */
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo a {
            font-size: 24px;
            font-weight: bold;
            color: #008850; /* 네이버 그린 */
            text-decoration: none;
        }
        nav a {
            margin-left: 20px;
            text-decoration: none;
            color: #1c1c1c;
            font-size: 14px;
        }
        nav a:hover {
            color: #008850;
        }

        /* 메인 컨텐츠 영역 */
        .main-content {
            width: 1080px;
            margin: 20px auto;
            display: flex;
            gap: 20px;
        }

        /* 왼쪽 섹션 (금융 지수 및 시가총액) */
        .left-section {
            flex: 2; /* 오른쪽보다 2배 넓게 */
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* 오른쪽 섹션 (LLM 챗봇) */
        .right-section {
            flex: 1;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            max-height: 800px;
        }

        /* 금융 지수 카드 스타일 */
        .index-cards {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        .index-card {
            background-color: #fff;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            flex: 1;
        }
        .index-name {
            font-size: 16px;
            color: #666;
            margin-bottom: 5px;
        }
        .index-value {
            font-size: 24px;
            font-weight: bold;
            color: #1c1c1c;
        }
        .index-change {
            font-size: 14px;
            margin-top: 5px;
        }
        .text-up { color: #d80000; } /* 빨간색 (상승) */
        .text-down { color: #0059c4; } /* 파란색 (하락) */
        .text-flat { color: #666; } /* 회색 (보합) */

        /* 시가총액 테이블 스타일 */
        .market-sum-table-container {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            overflow-x: auto; /* 모바일 대응을 위한 스크롤 */
        }
        .market-sum-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }
        .market-sum-table th, .market-sum-table td {
            padding: 10px;
            border-bottom: 1px solid #eee;
            text-align: right;
            white-space: nowrap; /* 셀 내용 줄바꿈 방지 */
        }
        .market-sum-table th {
            background-color: #f7f7f7;
            font-weight: 500;
            color: #666;
            text-align: center;
        }
        .market-sum-table td:first-child {
            text-align: left; /* 종목명은 왼쪽 정렬 */
            font-weight: bold;
            color: #333;
        }
        .text-right { text-align: right !important; }

        /* LLM 챗봇 스타일 */
        #llm-output {
            height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 15px;
            background-color: #f9f9f9;
            border-radius: 4px;
            white-space: pre-wrap; /* 줄바꿈 유지 */
        }
        #llm-chat-form {
            display: flex;
            gap: 10px;
        }
        #llm-input {
            flex-grow: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        #llm-submit {
            padding: 8px 15px;
            border: none;
            background-color: #008850;
            color: white;
            border-radius: 4px;
            cursor: pointer;
        }
        #llm-submit:disabled {
            background-color: #a8a8a8;
        }
    </style>
</head>
<body>

    <header>
        <div class="header-content">
            <div class="logo">증시 정보</div>
            <nav>
                <a href="https://finance.naver.com/sise/">국내 증시</a>
                <a href="https://finance.naver.com/world/">해외 증시</a>
                <a href="https://finance.naver.com/news/">주요 뉴스</a>
                <a href="index.html">커뮤니티</a>
            </nav>
        </div>
    </header>

    <div class="main-content">
        
        <!-- 왼쪽: 금융 지수 및 시가총액 -->
        <div class="left-section">
            
            <!-- 금융 지수 영역 -->
            <h2>주요 금융 지수</h2>
            <div class="index-cards">
                <div id="index-kospi" class="index-card">
                    <div class="index-name">KOSPI</div>
                    <div class="index-value">...</div>
                    <div class="index-change">...</div>
                </div>
                <div id="index-kosdaq" class="index-card">
                    <div class="index-name">KOSDAQ</div>
                    <div class="index-value">...</div>
                    <div class="index-change">...</div>
                </div>
                <div id="index-dow" class="index-card">
                    <div class="index-name">Dow Jones</div>
                    <div class="index-value">...</div>
                    <div class="index-change">...</div>
                </div>
                <div id="index-nasdaq" class="index-card">
                    <div class="index-name">NASDAQ</div>
                    <div class="index-value">...</div>
                    <div class="index-change">...</div>
                </div>
            </div>

            <!-- 시가총액 테이블 영역 -->
            <h2>코스피 시가총액 상위 종목</h2>
            <div class="market-sum-table-container">
                <p id="loading-status">데이터를 로드하는 중입니다...</p>
                <table class="market-sum-table" id="stock-market-sum-table" style="display: none;">
                    <thead>
                        <tr></tr>
                    </thead>
                    <tbody>
                        <!-- 데이터는 JavaScript로 채워집니다. -->
                    </tbody>
                </table>
            </div>

        </div>

        <!-- 오른쪽: LLM 챗봇 영역 -->
        <div class="right-section">
            <h2>LLM 금융 분석 챗봇</h2>
            <div id="llm-output">안녕하세요! 궁금한 점을 질문해 주세요.</div>
            <form id="llm-chat-form">
                <input type="text" id="llm-input" required>
                <button type="submit" id="llm-submit">분석 요청</button>
            </form>
        </div>

    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const loadingStatus = document.getElementById('loading-status');
            const stockTable = document.getElementById('stock-market-sum-table');
            const tableHead = stockTable.querySelector('thead tr');
            const tableBody = stockTable.querySelector('tbody');

            // API에서 주식 데이터를 불러오는 함수
            async function fetchStockData() {
                try {
                    // ⭐ 수정: Flask 서버의 API 엔드포인트로 요청
                    const response = await fetch('/api/stock/market-sum'); 
                    if (!response.ok) {
                        throw new Error(`HTTP 오류! 상태 코드: ${response.status}`);
                    }
                    const stocks = await response.json();
                    
                    loadingStatus.style.display = 'none'; // 로딩 메시지 숨김
                    
                    if (stocks.length > 0) {
                        renderTable(stocks);
                        stockTable.style.display = 'table'; // 테이블 표시
                    } else {
                        loadingStatus.textContent = "데이터를 불러오지 못했습니다. (DynamoDB 확인 필요)";
                        loadingStatus.style.display = 'block';
                    }

                } catch (error) {
                    console.error('데이터 로딩 오류:', error);
                    loadingStatus.textContent = `데이터 로드 중 오류 발생: ${error.message}`;
                    loadingStatus.style.display = 'block';
                }
            }

            // 받은 데이터로 HTML 테이블을 생성하는 함수
            function renderTable(stocks) {
                // 1. 테이블 헤더(th) 생성
                // clo.py에서 순서가 정리된 첫 번째 객체의 키를 사용
                const headers = Object.keys(stocks[0]);
                tableHead.innerHTML = ''; // 기존 헤더 초기화

                headers.forEach(header => {
                    const th = document.createElement('th');
                    th.textContent = header;
                    th.style.textAlign = 'center'; // 중앙 정렬 유지
                    tableHead.appendChild(th);
                });
                
                // 2. 테이블 바디(td) 생성
                tableBody.innerHTML = ''; // 기존 바디 초기화
                stocks.forEach(stock => {
                    const row = tableBody.insertRow();
                    
                    // 각 키-값 쌍을 순회하며 셀 생성
                    headers.forEach(key => {
                        const cell = row.insertCell();
                        let value = stock[key];
                        
                        // '종목명' 키가 아니면 오른쪽 정렬 스타일 적용
                        if (key !== '종목명') {
                            cell.classList.add('text-right');
                        } else {
                            // '종목명'은 왼쪽 정렬
                            cell.style.textAlign = 'left'; 
                            cell.style.fontWeight = 'bold';
                        }
                        
                        // 숫자에 천 단위 콤마 추가 (선택 사항)
                        if (!isNaN(value) && key !== '번호') {
                            value = value.toLocaleString('ko-KR');
                        }
                        
                        cell.textContent = value;
                    });
                });
            }

            // 페이지 로드 시 데이터 로딩 시작
            fetchStockData();
        });
        
        // ⚠️ LLM 챗봇 입력 처리 부분은 추가적인 API 개발이 필요합니다.
        document.getElementById('llm-chat-form').addEventListener('submit', function(event) {
            event.preventDefault();
            const input = document.getElementById('llm-input').value;
            document.getElementById('llm-output').textContent = `[사용자 질문] ${input}\n\n[봇 응답] LLM 챗봇 API 연동이 필요합니다.`;
            document.getElementById('llm-input').value = '';
        });

    </script>
</body>
</html>
